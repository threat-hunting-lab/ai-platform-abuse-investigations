# Hunt Queries — CVE-2025-12420 (Behavioral)

> These are templates. Adapt field/table names to your logging pipeline.
> Prefer correlation searches over single-event matches.

---

## A) Core correlation logic (pseudocode)
Goal: detect when agent activity precedes privileged identity changes.

1) Identify agent sessions (Virtual Agent / Now Assist) with session_id, user_identity, timestamp
2) Identify identity change events:
   - user created
   - user updated (email / identity binding changes)
   - role granted (especially admin-like roles)
   - password reset / account recovery
3) Join by:
   - time window (e.g., 0–30 minutes)
   - actor / created_by principal (system/integration/service account)
   - target identity (email/username) if present
4) Alert on:
   - new user + privileged role
   - role grants from agent-linked workflows
   - bursts of similar actions across multiple identities

---

## B) Generic SQL template (analytics / lake / SIEM backend)
Assumptions:
- `agent_sessions(session_id, user_email, started_at, source)`
- `audit_events(event_time, event_type, actor, target, target_email, details_json)`
- `auth_events(event_time, user, action, source_ip, result)`

### 1) New users created near agent sessions
```sql
SELECT
  a.session_id,
  a.user_email AS session_user,
  e.event_time,
  e.actor,
  e.target AS new_user,
  e.target_email
FROM agent_sessions a
JOIN audit_events e
  ON e.event_time BETWEEN a.started_at AND a.started_at + INTERVAL '30' MINUTE
WHERE e.event_type IN ('user_create','sys_user_insert')
;
